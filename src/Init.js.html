<script id="init">
/**
 * @file Init.js.html
 * @summary Client side scripting for the GS web app.
 *  Instances are generated so that classes can subscribe to pubsub events and respond accordingly.
 * @todo Add searchable fields to spreadsheets objects as they differ between sheets
 */
const gsUiConfig = {
  formId: 'search',
  radiosContainerId: 'data-sources',
  filterClass: 'filter',
  filtersContainerId: 'data-filters',
  filtersFocusTypeahead: true,
  spreadsheets: [
    {
      id: '1n4QOxfS3hDe3v9KKZt3HObIQZpQnk2sKT-GFcMXHjOc',
      sheet: 'Names',
    },
    // {
    //   id: '1n4QOxfS3hDe3v9KKZt3HObIQZpQnk2sKT-GFcMXHjOc',
    //   sheet: 'Door codes (imp)',
    // },
  ],
  typeaheadId: 'typeahead',
};

const gsUiInstance = new GsUi();

const gsUiCssInstance = new GsUiCss();

const gsUiTypeaheadInstance = new GsUiTypeahead({
  filterClass: gsUiConfig.filterClass,
  formId: gsUiConfig.formId,
  filtersContainerId: gsUiConfig.filtersContainerId,
  filtersFocusTypeahead: gsUiConfig.filtersFocusTypeahead,
  radiosContainerId: gsUiConfig.radiosContainerId,
  spreadsheets: gsUiConfig.spreadsheets,
  typeaheadId: gsUiConfig.typeaheadId,
});

// The typeahead created by gsUiTypeaheadInstance.initTypeahead
// This doesn't work as a property of gsUiTypeaheadInstance
let typeaheadInstance = null;

document.onreadystatechange = () => {
  // Polyfill for forEach
  if (window.NodeList && !NodeList.prototype.forEach) {
    NodeList.prototype.forEach = Array.prototype.forEach;
  }

  // Polyfill for forEach
  if (window.HTMLCollection && !HTMLCollection.prototype.forEach) {
    HTMLCollection.prototype.forEach = Array.prototype.forEach;
  }

  // The document has finished loading and the document has been parsed
  // but sub-resources such as images, stylesheets and frames are still loading.
  if (document.readyState === 'interactive') {
    // publish events for other modules to subscribe to

    pubsub.publish('domready');
  }

  // The document and all sub-resources have finished loading.
  // The state indicates that the load event is about to fire.
  if (document.readyState === 'complete') {
    // publish events for other modules to subscribe to

    pubsub.publish('windowLoad');
  }
};
</script>
